<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<style>
			#settingDiv {
				width: 100%;
				height: 100%;
				padding: 1.5rem;
				display: table-cell;
			}
        </style>
        <script src="resources/js/setting.js" type="text/javascript"></script>
	</head>
	<body>
		<div name="import-child" onload="SETTINGLoading();">
            <div id="settingDiv" class="uk-animation-fade" style="height: 100%; width:100%;">
                <!-- S:Modal -->
				<div id="version-modal" class="uk-flex-top" uk-modal="bg-close: false;">
					<div class="uk-modal-dialog uk-margin-auto-vertical" style="width: 70%;">
						<button class="uk-modal-close-default" type="button" uk-close></button>
						<div class="uk-modal-header uk-background-danger">
							<h2 class="uk-modal-title uk-text-white">버전 선택</h2>
						</div>
						<div class="uk-modal-body">
							<ul id="version-list" uk-accordion>
                            </ul>
						</div>
						<div class="uk-modal-footer">
							<div class="uk-text-right uk-flex-wrap-around">
								<button class="uk-button uk-button-default uk-modal-close" type="button" onclick="versionCancel();">취소</button>
                                <button class="uk-button uk-button-danger" type="button" onclick="versionApply();">적용</button>
							</div>
						</div>
					</div>
				</div>
				<!-- E:Modal -->
				<!-- S:SOPIA Setting -->
				<div class="uk-margin uk-card uk-card-default spoor-card" style="width: 100%;">
					<div class="uk-card-header">
						<div uk-grid>
							<div class="uk-width-1-2">
								<h3 class="uk-card-title uk-margin-remove-bottom">SOPIA 설정</h3>
							</div>
							<div class="uk-width-1-2 uk-text-right">
								<div class="uk-margin" style="margin-top: 5px;">
									<button id="sofiaSettingSave" onclick="sopiaSettingSave();" class="uk-button uk-button-spoon uk-button-small">SAVE</button>
								</div>
							</div>
						</div>
					</div>
					<div class="uk-card-body">
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>자동 매니저 멘트 시작</div>
							<div class="uk-text-right">
								<label class="switch">
									<input id="autoManagerStart" type="checkbox">
									<span class="slider round"></span>
								</label>
							</div>
						</div>
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>에디터 다크모드 적용</div>
							<div class="uk-text-right">
								<label class="switch">
									<input id="dark-editor" type="checkbox">
									<span class="slider round"></span>
								</label>
							</div>
						</div>
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>스푼 로그인 유지</div>
							<div class="uk-text-right">
								<label class="switch">
									<input id="keep-login" type="checkbox">
									<span class="slider round"></span>
								</label>
							</div>
						</div>
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>기본 스푼 Url</div>
							<div class="uk-text-right">
								<input id="default-url" class="uk-input uk-input-spoon uk-text-right" onclick="this.focus();" type="text">
							</div>
                        </div>
                        <div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>소피아 버전 관리</div>
							<div class="uk-text-right">
								<div class="uk-inline">
                                    <button
                                        id="version-select"
                                        class="uk-button uk-button-default"
                                        data-type="random"
                                        uk-toggle="target: #version-modal"
                                        type="button">최신 유지</button>
								</div>
							</div>
						</div>
                        <div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>소피아 홈페이지</div>
							<div class="uk-text-right">
								<div class="uk-inline">
                                    <a
                                        class="uk-button uk-button-default"
                                        data-type="random"
                                        href="https://sopia-bot.github.io/"
                                        target="_blank"
                                        type="button">새 창에서 열기</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- E:SOPIA Setting -->
				<!-- S:Auto Login -->
				<div class="uk-margin uk-card uk-card-default spoor-card" style="width: 100%;">
					<div class="uk-card-header">
						<div uk-grid>
							<div class="uk-width-1-2">
								<h3 class="uk-card-title uk-margin-remove-bottom">자동 로그인</h3>
							</div>
							<div class="uk-width-1-2 uk-text-right">
								<div class="uk-margin" style="margin-top: 5px;">
									<button id="autoLoginSave" onclick="autoLoginSettingSave();" class="uk-button uk-button-spoon uk-button-small">SAVE</button>
								</div>
							</div>
						</div>
					</div>
					<div class="uk-card-body">
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>자동 로그인</div>
							<div class="uk-text-right">
								<label class="switch">
									<input id="autoLoginEnable" type="checkbox">
									<span class="slider round"></span>
								</label>
							</div>
						</div>
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>자동 로그인 타입</div>
							<div class="uk-text-right">
								<div class="uk-inline">
									<button id="autoLoginType" class="uk-button uk-button-default" data-type="phone" type="button">핸드폰 번호</button>
									<div uk-dropdown="pos: top-right">
										<ul id="altItems" class="uk-nav uk-dropdown-nav">
											<li class="uk-active" onclick="altSelect(event);" name="autoLoginTypeItems" data-type="phone"><a href="#">핸드폰 번호</a></li>
											<li class="uk-nav-divider"></li>
											<li data-type="email" onclick="altSelect(event);" name="autoLoginTypeItems"><a href="#">이메일</a></li>
											<li class="uk-nav-divider"></li>
											<li data-type="facebook" onclick="altSelect(event);" name="autoLoginTypeItems"><a href="#">페이스북</a></li>
											<li class="uk-nav-divider"></li>
											<li data-type="google" onclick="altSelect(event);" name="autoLoginTypeItems"><a href="#">구글</a></li>
										</ul>
									</div>
								</div>
							</div>
						</div>
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>자동 로그인 아이디</div>
							<div class="uk-text-right">
								<input id="autoLoginId" class="uk-input uk-input-spoon uk-text-right" onclick="this.focus();" type="text">
							</div>
						</div>
						<div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
							<div>자동 로그인 비밀번호</div>
							<div class="uk-text-right">
								<input id="autoLoginPw" class="uk-input uk-input-spoon uk-text-right" onclick="this.focus();" type="password">
							</div>
						</div>
					</div>
				</div>
				<!-- E:Auto Login -->
			</div>
		</div>
		<script type="text/javascript">

			/**
			 * @function sopiaSettingSave
			 * SOPIA 설정에 대한 값을 변경하고 저장한다.
			 */
			const sopiaSettingSave = () => {
				sopia.config.sopia.autostart = document.querySelector('#autoManagerStart').checked;
				sopia.config.sopia['dark-editor'] = document.querySelector('#dark-editor').checked;
				sopia.config.sopia['keep-login'] = document.querySelector('#keep-login').checked;
				sopia.config.sopia['default-url'] = document.querySelector('#default-url').value;
				sopia.debug(sopia.config.sopia, "save");
				AllSettingSave();
			};

			/**
			 * @function autoLoginSettingSave
			 * 자동 로그인 설정에 대한 값을 변경하고 저장한다.
			 */
			const autoLoginSettingSave = () => {
				sopia.config.autologin.enable = document.querySelector('#autoLoginEnable').checked;
				sopia.config.autologin.id = document.querySelector('#autoLoginId').value;
				sopia.config.autologin.passwd = document.querySelector('#autoLoginPw').value;
				sopia.config.autologin.type = document.querySelector('#autoLoginType').getAttribute('data-type');
				sopia.debug(sopia.config.autologin, "save");
				AllSettingSave();
			};


			/**
			 * @function altSelect
			 * @param {MouseEvent} e
			 * 로그인 타입 dropmenu를 선택하는 함수.
			 */
			const altSelect = e => {
				let alt = document.querySelector('#autoLoginType');
				let li = e.target;
				if ( li.tagName.toLowerCase() === "a" ) {
					li = li.parentElement;
				}

				if ( alt ) {
					alt.innerText = li.innerText;
					alt.setAttribute('data-type', li.getAttribute('data-type'));

					let selected = document.querySelector('#altItems>li.uk-active');
					if ( selected.className !== li.className ) {
						document.querySelectorAll('li[name="autoLoginTypeItems"]').forEach(element => {
							if ( element.getAttribute('data-type') === li.getAttribute('data-type') ) {
								element.className = "uk-active";
							} else {
								element.className = "";
							}
						});
					}

					switch ( li.getAttribute('data-type') ) {
						case "phone":
						case "email":
							document.querySelector('#autoLoginId').disabled = false;
							document.querySelector('#autoLoginPw').disabled = false;
							break;
						case "facebook":
						case "google":
							document.querySelector('#autoLoginId').disabled = true;
							document.querySelector('#autoLoginPw').disabled = true;
							break;
						default:
							sopia.error(li.getAttribute('data-type'));
					}
				}
			};
		</script>
	</body>
</html>
